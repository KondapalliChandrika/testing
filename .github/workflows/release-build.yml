name: Android APK Build (Debug + Signed Release)

on:
  push:
    branches:
      - master
      - main
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest


    steps:
      # 1Ô∏è‚É£ Checkout code
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2Ô∏è‚É£ Setup Node
      - name: Set up Node
        uses: actions/setup-node@v3
        with:
          node-version: "20"

      # 3Ô∏è‚É£ Install Node dependencies
      - name: Install Node dependencies
        run: npm ci

      # 4Ô∏è‚É£ Cache Gradle
      - name: Cache Gradle
        uses: actions/cache@v4
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}

      # 5Ô∏è‚É£ Setup Java 17
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          distribution: "temurin"
          java-version: "17"

      # 6Ô∏è‚É£ Grant Gradle permission
      - name: Grant execute permission to Gradle
        run: chmod +x android/gradlew

      # 7Ô∏è‚É£ Build DEBUG APK
      - name: Build Debug APK
        run: cd android && ./gradlew assembleDebug --no-daemon

      # 8Ô∏è‚É£ Build SIGNED RELEASE APK ‚úÖ
      - name: Build Signed Release APK
        env:
          KEYSTORE_PASSWORD: ${{ secrets.KEYSTORE_PASSWORD }}
          KEY_ALIAS: ${{ secrets.KEY_ALIAS }}
          KEY_PASSWORD: ${{ secrets.KEY_PASSWORD }}
        run: cd android && ./gradlew assembleRelease --no-daemon

      # 9Ô∏è‚É£ Upload Debug APK
      - name: Upload Debug APK
        uses: actions/upload-artifact@v4
        with:
          name: app-debug
          path: android/app/build/outputs/apk/debug/*.apk

      # üîü Upload SIGNED Release APK ‚úÖ‚úÖ‚úÖ
      - name: Upload Release APK
        uses: actions/upload-artifact@v4
        with:
          name: app-release
          path: android/app/build/outputs/apk/release/*.apk






# name: Android APK Build

# on:
#   push:
#     branches:
#       - master
#       - main
#   pull_request:

# jobs:
#   build:
#     runs-on: ubuntu-latest

#     steps:
#       # ‚úÖ 1. Checkout repository
#       - name: Checkout repository
#         uses: actions/checkout@v3

#       # ‚úÖ 2. Setup Node.js (needed for React Native & npx)
#       - name: Set up Node
#         uses: actions/setup-node@v3
#         with:
#           node-version: "18"

#       # ‚úÖ 3. Install Node dependencies
#       - name: Install Node dependencies
#         run: npm ci

#       # ‚úÖ 4. Cache Gradle for faster builds
#       - name: Cache Gradle
#         uses: actions/cache@v4
#         with:
#           path: |
#             ~/.gradle/caches
#             ~/.gradle/wrapper
#           key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
#           restore-keys: |
#             ${{ runner.os }}-gradle-

#       # ‚úÖ 5. Setup Java 17 (required for modern Android)
#       - name: Set up JDK 17
#         uses: actions/setup-java@v3
#         with:
#           distribution: "temurin"
#           java-version: "17"

#       # ‚úÖ 6. Give execution permission to gradlew (CORRECT PATH ‚úÖ)
#       - name: Grant execute permission to Gradle
#         run: chmod +x android/gradlew

#       # ‚úÖ 7. Build Debug APK (CORRECT DIRECTORY ‚úÖ)
#       - name: Build Debug APK
#         run: cd android && ./gradlew assembleDebug --no-daemon

#       # ‚úÖ 8. Upload APK Artifact (FIXED v4 ‚úÖ)
#       - name: Upload APK Artifact
#         uses: actions/upload-artifact@v4
#         with:
#           name: app-debug
#           path: android/app/build/outputs/apk/debug/*.apk
